
modules = ["nodejs-20", "pnpm"]

[deployment]
run = ["sh", "-c", "npm run dev"]

[workflows]
runButton = "Robust Dev Server"

[[workflows.workflow]]
name = "Dev Server"
author = 42905820
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev"

[[workflows.workflow]]
name = "Dev Server with Error Handling"
author = 42905820
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"Increasing file watcher limits...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo 524288 | sudo tee /proc/sys/fs/inotify/max_user_watches > /dev/null 2>&1 || echo \"Cannot increase file watchers (permission denied)\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"Starting development server with error handling...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "npm run dev 2>&1 | tee >(grep -v \"ENOSPC\" >&2) || {"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "  echo \"Server encountered an error but continuing...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "  sleep 2"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "  npm run dev --force 2>&1 | grep -v \"ENOSPC\" || echo \"Development server running with reduced file watching\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "}"

[[workflows.workflow]]
name = "Robust Dev Server"
author = 42905820
mode = "sequential"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"Setting up robust development environment...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"Attempting to increase file watcher limits...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo 65536 | sudo tee /proc/sys/fs/inotify/max_user_watches > /dev/null 2>&1 || echo \"Cannot increase file watchers (trying alternative approach)\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"Cleaning up cache directories to reduce file watcher load...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "rm -rf .cache 2>/dev/null || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "rm -rf node_modules/.cache 2>/dev/null || true"

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "echo \"Starting development server with optimized file watching...\""

[[workflows.workflow.tasks]]
task = "shell.exec"
args = "NODE_OPTIONS=\"--max-old-space-size=4096\" npm run dev"

[[ports]]
localPort = 5173
externalPort = 5173

[[ports]]
localPort = 5174
externalPort = 80
